TODO for Cline.

- [x] Refactor Threads.php
    - [x] Split out file operations into ThreadFileOperations.php
    - [x] Split out utility functions into ThreadUtils.php
    - [x] Split out email services into ThreadEmailService.php
- [x] Rewrite auth service to automatic create tokens since it's only for development
    - Goal: Opening http://localhost:25081/ should work. It should redirect to login and then back. Verify that tokens are used.
    - [x] Look into the auth service to figure out tasks.
- [x] Separate docker compose config prod and dev
- [ ] Rig for testing
    - [x] Search for file operations and make the path configurable
    - [ ] Basic unit tests for thread functionality
        - [x] Test ThreadFileOperations.php
            - [x] Test getThreads() function
            - [x] Test getThreadFile() function
            - [x] Test getThreadsForEntity() function
        - [x] Test ThreadUtils.php
            - [x] Test getThreadId() function
                - [x] Test UTF-8 string normalization
                - [x] Test space replacement
                - [x] Test forward slash replacement
            - [x] Test getLabelType() function
                - [x] Test all status types (info, disabled, danger, success, unknown)
                - [x] Test error case for invalid status type
        - [x] Test ThreadEmailService.php
            - [x] Test email sending success/failure
            - [x] Test email data validation
            - [x] Test error handling
            - [x] Test debug output
    - [ ] update-imap.php
        - [x] Restructure into multiple files to make it testable
            - [x] ImapConnection: Core IMAP connection handling
            - [x] ImapFolderManager: Folder operations
            - [x] ImapEmailProcessor: Email and cache handling
            - [x] ImapAttachmentHandler: Attachment processing
        - [ ] Add unit tests for IMAP operations
            - [x] Test ImapConnection class
            - [x] Test ImapFolderManager class
            - [x] Test ImapEmailProcessor class
            - [x] Test ImapAttachmentHandler class
                - [x] Test attachment processing with different file types (currently all detected as PDF)
                - [x] Test special encoding handling for filenames
        - [x] Figure out why testProcessAttachmentsWithDifferentFileTypes does not work
        - [ ] Add integration tests with test IMAP server
    - [ ] Setup development IMAP server
        - [ ] Docker container for IMAP server
        - [ ] Configuration for test environment
        - [ ] Test data setup scripts
    - [ ] End-to-end testing
        - [ ] Test email flow from SMTP to IMAP
        - [ ] Test thread creation and updates
        - [ ] Test attachment handling
- [ ] GUI for reading threads
    - [ ] Thread list view
    - [ ] Thread detail view
    - [ ] Email composition interface
    - [ ] Attachment handling UI
- [ ] GUI for replying to threads
    - [ ] Reply form with rich text editor
    - [ ] Template system for common responses
    - [ ] Attachment upload functionality

TODO - medium term:
- [ ] Automatic follow up
    - [ ] Scheduled email sending system
    - [ ] Response tracking
    - [ ] Automated reminder system
    - [ ] Configurable follow-up rules
